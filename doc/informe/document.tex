\documentclass[12pt]{article}

%Packages
\usepackage[latin1]{inputenc}
% Esto es para que el LaTeX sepa que el texto estÃ¡ en espaÃ±ol:
\usepackage[spanish]{babel}
\usepackage[x11names,table]{xcolor}

% Paquetes de la AMS:
%\usepackage[total={6in,11in},top=0.50in, left=1in]{geometry}
\usepackage[top=1in, left=1in, right=1in, bottom=1in]{geometry}
\usepackage{amsmath, amsthm, amsfonts}
\usepackage{graphics}
\usepackage{listings}
\usepackage{float}
\usepackage{epsfig}
\usepackage{amssymb}


\lstset{ %
	language=prolog, % lenguaje
	basicstyle=\normalsize\ttfamily,
	keywordstyle=\color{blue},
	commentstyle=\color{blue!50},
	backgroundcolor=\color{gray!9},
	identifierstyle = \color{gray!161},
	stringstyle = \color{yellow},
	numberstyle = \color{green},
	columns=fullflexible,
	showspaces=false
}



\newtheorem{thm}{Teorema}[section]
\newtheorem{cor}[thm]{Corolario}
\newtheorem{lem}[thm]{Lema}
\newtheorem{prop}[thm]{ProposiciÃ³n}
\theoremstyle{definition}
\newtheorem{defn}[thm]{Definicion}
\theoremstyle{remark}
\newtheorem{rem}[thm]{ObservaciÃ³n}

\def\RR{\mathbb{R}}

\renewcommand{\labelenumi}{$\bullet$}
\newtheorem{definition}{Definición}[section]
\newtheorem{theorem}{Teorema}[section]
\newtheorem{corollary}{Corolario}[section]
\newtheorem{lemma}{Lema}[section]
\newtheorem{proposition}{Proposición}[section]
\newcommand{\statement}[3]{
	\begin{center}
		{ \fcolorbox {gray!11}{gray!11}{
				\begin{minipage}[h!]{\textwidth}
					\begin{#1}\label{#3}
						#2
					\end{#1}
				\end{minipage} } }
			\end{center}}
			\renewcommand{\proof}[1]{{\it Demostración}\\ #1 \hfill\blacksquare}
\newcommand{\pagediv}[4]
{
	\begin{figure}[!h]
		\begin{minipage}[b]{#1\textwidth}
			#3			
		\end{minipage} \hfill 
		\begin{minipage}[b]{#2\textwidth}
			#4
		\end{minipage}
	\end{figure}
	
}



%define title
\author{
	Dalianys P\'erez Perera\\
	Dayany Alfaro González\\
	C-411 \\
}
\title{Azul   \\
	Programación Declarativa
	}

\date{}
\begin{document}
%generates the title
\maketitle

\selectlanguage{spanish}

\newpage
%insert table contents
\tableofcontents
\newpage

\section {Estrategia}
Cada jugador tiene que decidir qué azulejos va a tomar, de dónde los va a tomar y dónde los va a colocar, para esto se implementó una estrategia de selección que se va describir a continuación.
Como punto de partida es necesario tener un conjunto de todos los movimientos factibles a realizar, donde por movimiento factible se entiende que sea válido colocar en la fila seleccionada (o el suelo) los azulejos de un determinado color tomados de una de las fábricas o el centro de la mesa. Para obtener esto se crearon todas las combinaciones de movimientos posibles, o sea, tanto válidos como inválidos y se filtraron mediante la evaluación del predicado \lstinline|factible_move| para determinar si eran factibles o no.

Sea \lstinline|All_moves| el conjunto de movimientos factibles para el jugador \lstinline|ID|, va a estar representado por una lista de tuplas con el formato \lstinline|[(Source, Color, Amount, Stair, Chip),...]| que indica que se toman \lstinline|Amount| fichas de color \lstinline|Color|(1,2,3,4,5 según el color) desde \lstinline|Source| (0,1...$k$) si son del suelo o de la fábrica $k$ respectivamente) hacia la fila \lstinline|Stair| y \lstinline|Chip| va a ser 0 o 1 en dependencia de si se tomó o no la ficha de jugador inicial. Si \lstinline|All_moves| $\neq \emptyset$  se va a seleccionar un movimiento en el siguiente orden:
\begin{itemize}
	\item[1.] 
	 \begin{itemize}
	 	\item Seleccionar de \lstinline|All_moves| aquellos movimientos que al realizarse completen exactamente una fila y con estos formar el conjunto \lstinline|Moves|.
	 	\item Si el jugador no lleva la delantera en la puntuación tampoco van a pertenecer a \lstinline|Moves| aquellos movimientos que completarían una fila en el muro en la fase 2 y, por tanto, finalizarían la partida.
	 	\item Si \lstinline|Moves| $\neq \emptyset$:
	 	\begin{itemize}
	 		\item Ordenar \lstinline|Moves| de menor a mayor según la cantidad de azulejos directamente conectados en línea recta en la fila y/o columna que tiene en el muro el color que se completaría. 
	 		\item Seleccionar como movimiento a realizar el último elemento de \lstinline|Moves| y parar de buscar, con lo que se busca maximizar el número de puntos a obtener en la fase de revestir el muro. 
	 	\end{itemize} 
	 \end{itemize}
 	\begin{lstlisting}
 	get_moves_overfill(ID, All_moves, K, Moves) :-
 		setof((Ady, Src, Clr, Amnt, St, Ch),
 		Free^(member((Src, Clr, Amnt, St, Ch), All_moves),
 	 	get_free_space(ID, St, Free), Amnt-Free=:=K,
 	  	get_adyacents(ID, St, Clr, Ady),
 	   	(is_not_game_move(ID, St, Clr);is_winning(ID))),
 		Moves).
 		
	strategy(ID, All_moves, Source, Color, Amount, Stair, Chip) :-
		get_moves_overfill(ID, All_moves, 0, Moves),
		last(Moves,
		(_, Source, Color, Amount, Stair, Chip)), !.
 	\end{lstlisting}
 	\item[2.] 
 	\begin{itemize}
 		\item Seleccionar de \lstinline|All_Moves| aquellos movimientos que al realizarse completen una fila y sobre exactamente un azulejo y con estos formar el conjunto \lstinline|Moves|.
 		\item Si el jugador no lleva la delantera en la puntuación tampoco van a pertenecer a \lstinline|Moves| aquellos movimientos que completarían una fila en el muro en la fase 2 y, por tanto, finalizarían la partida. 
 	   \item Si \lstinline|Moves| $\neq \emptyset$:
 	\begin{itemize}
 		\item Ordenar \lstinline|Moves| de menor a mayor según la cantidad de azulejos directamente conectados en línea recta en la fila y/o columna que tiene en el muro el color que se completaría.
 		\item Seleccionar como movimiento a realizar el último elemento de \lstinline|Moves| y parar de buscar. 
 	 	\end{itemize}	
 	\end{itemize}
 \begin{lstlisting}
 	strategy(ID, All_moves, Source, Color, Amount, Stair, Chip) :-
 		get_moves_overfill(ID, All_moves, 1, Moves),
 		last(Moves,
 		(_, Source, Color, Amount, Stair, Chip)), !.
 \end{lstlisting}
 	\item[3.] 
 \begin{itemize}
 	\item Seleccionar de \lstinline|All_Moves| aquellos movimientos que al realizarse no alcancen a completar exactamente una fila y además esta ya contenga al menos un azulejo, y con estos formar el conjunto \lstinline|Moves|.
 	\item Si \lstinline|Moves| $\neq \emptyset$:
 	\begin{itemize}
 		\item Ordenar \lstinline|Moves| de menor a mayor según la cantidad de espacios vacíos que quedarían en la fila al colocar los azulejos.
 		\item Seleccionar como movimiento a realizar el primer elemento de \lstinline|Moves| y parar de buscar.
 	\end{itemize}
  \end{itemize}
 \begin{lstlisting}
 	get_moves_incomplete_to_nonempty(ID, All_moves, Moves) :-
 		setof((Incomplete, Src, Clr, Amnt, St, Ch),
 		Free^(member((Src, Clr, Amnt, St, Ch), All_moves),
 		get_free_space(ID, St, Free), Incomplete is Free-Amnt,
 		Incomplete>0, stair(ID, St, 1, Clr)),
 		Moves).
 		
 	strategy(ID, All_moves, Source, Color, Amount, Stair, Chip) :-
 		get_moves_incomplete_to_nonempty(ID,All_moves,
 		[ (_, Source, Color, Amount, Stair, Chip)|_]), !.
 \end{lstlisting} 
	\item[4.] 
\begin{itemize}
	\item Seleccionar de \lstinline|All_Moves| aquellos movimientos que al realizarse no alcancen a completar exactamente una fila y con estos formar el conjunto \lstinline|Moves|.
	\item Si \lstinline|Moves| $\neq \emptyset$:
	\begin{itemize}
		\item Ordenar \lstinline|Moves| de menor a mayor según la cantidad de espacios vacíos que quedarían en la fila al colocar los azulejos.
		\item Seleccionar como movimiento a realizar el primer elemento de \lstinline|Moves| y parar de buscar.
	\end{itemize} 
\end{itemize}
\begin{lstlisting}
	get_moves_incomplete(ID, All_moves, Moves) :-
		setof((Incomplete, Src, Clr, Amnt, St, Ch),
		Free^(member((Src, Clr, Amnt, St, Ch), All_moves),
	 	get_free_space(ID, St, Free), Incomplete is Free-Amnt,
	  	Incomplete>0),Moves).
	  	
	strategy(ID, All_moves, Source, Color, Amount, Stair, Chip) :-
	  	get_moves_incomplete(ID,All_moves,	  	
	  	[ (_, Source, Color, Amount, Stair, Chip)|_]), !.
\end{lstlisting}
\item[5.] 
\begin{itemize}
	\item Seleccionar de \lstinline|All_Moves| aquellos movimientos que no provocan que se acabe el juego al llenar una fila del muro en la siguiente fase (LLegado a este punto estos movimientos se rechazaron anteriormente porque el jugador no contaba con la mayor puntuación, por tanto ahora tampoco sería conveniente seleccionarlos, mientras que el resto de los movimientos tras haber sido descartados por las variantes anteriores solo pueden ser movimientos que completen una fila y sobre una cantidad mayor que 1 de azulejos que irían al suelo o que no se puedan colocar en  ninguna fila y vayan directamente al suelo) y con estos formar el conjunto \lstinline|Moves|.
	\item Si \lstinline|Moves| $\neq \emptyset$:
	\begin{itemize}
		\item Ordenar \lstinline|Moves| de menor a mayor según la cantidad de azulejos que serían enviados al suelo.
		\item Seleccionar como movimiento a realizar el primer elemento de $F_5$ y parar de buscar.
	\end{itemize} 
\end{itemize}
\begin{lstlisting}
	strategy(ID, All_moves, Source, Color, Amount, Stair, Chip) :-
		setof((Extra, Src, Clr, Amnt, St, Ch),
		Free^(member((Src, Clr, Amnt, St, Ch), All_moves),
		get_free_space(ID, St, Free), Extra is Amnt-Free,
		is_not_game_move(ID, St, Clr)),	
		[ (_, Source, Color, Amount, Stair, Chip)|_]), !.
\end{lstlisting}
\item[6.] 
\begin{itemize}
	\item Alcanzar este punto significa que todos los movimientos en \lstinline|All_Moves| son aquellos que provocan el fin del juego al revestir el muro o que colocan las fichas directamente en el suelo

	\item Ordenar \lstinline|All_Moves| de menor a mayor según la cantidad de azulejos que serían enviados al suelo.
	\item Seleccionar como movimiento a realizar el primer elemento de \lstinline|All_Moves|.
\end{itemize}
\begin{lstlisting}
	strategy(ID, All_moves, Source, Color, Amount, Stair, Chip) :-
		setof((Extra, Src, Clr, Amnt, St, Ch),
		Free^(member((Src, Clr, Amnt, St, Ch), All_moves),
	 	get_free_space(ID, St, Free), Extra is Amnt-Free),
		[ (_, Source, Color, Amount, Stair, Chip)|_]).
\end{lstlisting}
\end{itemize}


    




\end{document}
